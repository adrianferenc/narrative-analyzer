<%- include('../partials/header') %>
<!-- Masthead-->
<header class="masthead">
  <div class="container">
    <div class="masthead-subheading">Students</div>
  </div>
</header>
<!-- Services-->
<section class="page-section" id="students">
  <% if (students.length>0) { %>
  <h3>List of Students</h3>
  <div class="accordion" id="accordionExample">
    <% students.forEach(student => { %>

    <div class="accordion-item">
      <h2 class="accordion-header d-grid gap-2 d-md-block">
        <div
          class="btn-toolbar"
          role="toolbar"
          aria-label="Toolbar with button groups"
        >
          <div class="btn-group" role="group" aria-label="Group">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse<%=student._id%>"
              aria-expanded="false"
              aria-controls="collapse"
            >
              <%=student.name%>
            </button>
            <form
              action="/students/<%-student._id%>?_method=DELETE"
              method="POST"
            >
              <button
                type="button"
                class="btn btn-danger btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal"
              >
                Delete
              </button>
              <div
                class="modal fade"
                id="deleteModal"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="deleteModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="staticBackdropLabel">
                        Deletion is Permanent
                      </h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                      Deleting a student will also delete all narratives
                      associated with that student.
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                      <button type="submit" class="btn btn-danger">
                        Delete Student
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </h2>
      <div
        id="collapse<%=student._id%>"
        class="accordion-collapse collapse"
        aria-labelledby="headingTwo"
        data-bs-parent="#accordionExample"
      >
        <div class="accordion-body">
          <div class="d-md-inline">
          <% for( let category in student.categories ) { %>
          <strong><%=category%></strong>: <%=student.categories[category]%>
          <% } %>
        </div>
          <ul>
            <% studentNarratives[student.name].forEach(narrative => { %>
            <li><%=narrative.text%></li>
            <% }) %>
          </ul>
          <form action="students/<%-student._id%>" method="GET">
            <button type="submit" class="btn btn-secondary">Update <%=student.name%></button>
            </form>
          
        </div>
      </div>
    </div>
  </div>
  <% }) %> 
  <% } %>
  <div class="d-flex justify-content-center mt-4">
  <form action="/students/new">
    <button class="btn btn-primary">Add a student</button>
  </form>
</div>
</section>
<!-- Footer-->
<%- include('../partials/footer') %>
